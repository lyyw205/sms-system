# í…œí”Œë¦¿ ë³€ìˆ˜ ì‹œìŠ¤í…œ êµ¬í˜„ ì™„ë£Œ

## ğŸ¯ ëª©í‘œ

- ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜ë¥¼ ëª…í™•íˆ ì •ì˜
- ëª¨ë‹¬ì—ì„œ ë³€ìˆ˜ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ ë° ì„ íƒ
- ì •ì˜ëœ ë³€ìˆ˜ë§Œ ì‚¬ìš©í•˜ë„ë¡ ê°•ì œ
- ë°±ì—”ë“œì—ì„œ ìë™ ë³€ìˆ˜ ê³„ì‚°

## âœ… ì™„ë£Œëœ ì‘ì—…

### 1. **ë°±ì—”ë“œ: ë³€ìˆ˜ ì •ì˜ ì‹œìŠ¤í…œ** (`backend/app/templates/variables.py`)

#### ì •ì˜ëœ ë³€ìˆ˜ ì¹´í…Œê³ ë¦¬

| ì¹´í…Œê³ ë¦¬ | ë³€ìˆ˜ë“¤ |
|----------|--------|
| **ì˜ˆì•½ ì •ë³´** | `name`, `phone` |
| **ê°ì‹¤ ì •ë³´** | `building`, `roomNum`, `roomNumber`, `roomInfo`, `password` |
| **íŒŒí‹° ì •ë³´** | `priceInfo`, `partyTime`, `secondPartyTime`, `totalParticipants`, `femaleCount`, `maleCount` |
| **ë‚ ì§œ/ì‹œê°„** | `date`, `time` |
| **ê¸°íƒ€** | `location` |

#### ìë™ ê³„ì‚° ê¸°ëŠ¥

```python
calculate_template_variables(reservation, db, date, custom_vars)
```

**ìë™ìœ¼ë¡œ ê³„ì‚°ë˜ëŠ” ê°’:**
- `building`, `roomNum`: `roomNumber`ì—ì„œ íŒŒì‹± (ì˜ˆ: A101 â†’ A, 101)
- `totalParticipants`, `femaleCount`, `maleCount`: í•´ë‹¹ ë‚ ì§œ í™•ì • ì˜ˆì•½ ê¸°ì¤€ ì‹¤ì‹œê°„ ê³„ì‚°
- `priceInfo`, `partyTime`, `location` ë“±: ê¸°ë³¸ê°’ ì œê³µ
- Custom variablesë¡œ ë®ì–´ì“°ê¸° ê°€ëŠ¥

### 2. **ë°±ì—”ë“œ: API ì—”ë“œí¬ì¸íŠ¸** (`backend/app/api/templates.py`)

```
GET /api/template-variables
```

**ì‘ë‹µ í˜•ì‹:**
```json
{
  "variables": {
    "name": {
      "description": "ì˜ˆì•½ì ì´ë¦„",
      "example": "ê¹€ì² ìˆ˜",
      "category": "reservation"
    },
    ...
  },
  "categories": {
    "reservation": [
      {
        "name": "name",
        "description": "ì˜ˆì•½ì ì´ë¦„",
        "example": "ê¹€ì² ìˆ˜"
      }
    ],
    ...
  }
}
```

### 3. **ë°±ì—”ë“œ: ìº í˜ì¸ ë°œì†¡ ìë™ ë³€ìˆ˜ ì£¼ì…** (`backend/app/campaigns/tag_manager.py`)

**ê¸°ì¡´:**
```python
message_vars = {
    'name': reservation.customer_name,
    'roomNumber': reservation.room_number or '',
    'roomPassword': reservation.room_password or ''
}
```

**ìˆ˜ì • í›„:**
```python
message_vars = calculate_template_variables(
    reservation=reservation,
    db=self.db,
    date=date,
    custom_vars=variables
)
```

**ê²°ê³¼:** ëª¨ë“  ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜ ìë™ ê³„ì‚° ë° ì£¼ì…

### 4. **í”„ë¡ íŠ¸ì—”ë“œ: ë³€ìˆ˜ ì„ íƒ UI** (`frontend/src/pages/Templates.tsx`)

#### ì¶”ê°€ëœ ê¸°ëŠ¥

1. **ë³€ìˆ˜ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°**
   ```typescript
   const fetchAvailableVariables = async () => {
     const response = await templatesAPI.getAvailableVariables();
     setAvailableVariables(response.data);
   };
   ```

2. **Select ì»´í¬ë„ŒíŠ¸ë¡œ ë³€ê²½**
   - ê¸°ì¡´: `<Input>` (ììœ  ì…ë ¥)
   - ë³€ê²½: `<Select mode="tags">` (ì„ íƒ + ì…ë ¥)

3. **ë³€ìˆ˜ ë¦¬ìŠ¤íŠ¸ í‘œì‹œ**
   - ì¹´í…Œê³ ë¦¬ë³„ ê·¸ë£¹í™”
   - ê° ë³€ìˆ˜ì˜ ì„¤ëª…ê³¼ ì˜ˆì‹œ í‘œì‹œ
   - ì‹¤ì‹œê°„ ê²€ìƒ‰/í•„í„°ë§

#### UI ë¯¸ë¦¬ë³´ê¸°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜                             â”‚
â”‚ [name] [building] [roomNum] ...             â”‚
â”‚                                             â”‚
â”‚ ğŸ’¡ ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜ ëª©ë¡                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚ â”‚ ğŸ“‹ ì˜ˆì•½ ì •ë³´                         â”‚    â”‚
â”‚ â”‚   {{name}} - ì˜ˆì•½ì ì´ë¦„             â”‚    â”‚
â”‚ â”‚   {{phone}} - ì „í™”ë²ˆí˜¸               â”‚    â”‚
â”‚ â”‚                                     â”‚    â”‚
â”‚ â”‚ ğŸ¨ ê°ì‹¤ ì •ë³´                         â”‚    â”‚
â”‚ â”‚   {{building}} - ê±´ë¬¼ (A, B ë“±)     â”‚    â”‚
â”‚ â”‚   {{roomNum}} - í˜¸ìˆ˜ (101, 205 ë“±)  â”‚    â”‚
â”‚ â”‚   {{password}} - ê°ì‹¤ ë¹„ë°€ë²ˆí˜¸       â”‚    â”‚
â”‚ â”‚                                     â”‚    â”‚
â”‚ â”‚ ğŸ‰ íŒŒí‹° ì •ë³´                         â”‚    â”‚
â”‚ â”‚   {{priceInfo}} - íŒŒí‹° ê°€ê²© ì•ˆë‚´     â”‚    â”‚
â”‚ â”‚   {{totalParticipants}} - ì´ ì°¸ì—¬ì¸ì›â”‚    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5. **ë°ì´í„°ë² ì´ìŠ¤: í…œí”Œë¦¿ ì—…ë°ì´íŠ¸**

ë³€ìˆ˜ëª… í†µì¼:
- ~~`customerName`~~ â†’ `name`
- `partyTime` ëª…ì‹œì  ì‚¬ìš© (í•˜ë“œì½”ë”©ëœ "ì €ë… 8ì‹œ" ì œê±°)

## ğŸ”§ ì‘ë™ ë°©ì‹

### í…œí”Œë¦¿ ìƒì„±/í¸ì§‘ ì‹œ

1. ì‚¬ìš©ìê°€ Templates í˜ì´ì§€ ì—´ê¸°
2. APIì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜ ëª©ë¡ ìë™ ë¡œë“œ
3. ëª¨ë‹¬ì—ì„œ ë³€ìˆ˜ ì„ íƒ
   - ë“œë¡­ë‹¤ìš´ì—ì„œ ì„ íƒ
   - ë˜ëŠ” ì§ì ‘ ì…ë ¥ (íƒœê·¸ ëª¨ë“œ)
4. ì„ íƒí•œ ë³€ìˆ˜ë§Œ í…œí”Œë¦¿ contentì—ì„œ ì‚¬ìš©

### ìº í˜ì¸ ë°œì†¡ ì‹œ

1. ì‚¬ìš©ìê°€ ìº í˜ì¸ ë°œì†¡ ìš”ì²­
2. ë°±ì—”ë“œì—ì„œ ê° reservationì— ëŒ€í•´:
   ```python
   variables = calculate_template_variables(reservation, db, date)
   # ìë™ìœ¼ë¡œ ëª¨ë“  ë³€ìˆ˜ ê³„ì‚°:
   # - name: "ê¹€ì² ìˆ˜"
   # - building: "A"
   # - roomNum: "101"
   # - totalParticipants: "25"
   # - femaleCount: "12"
   # - priceInfo: "ë‚¨ì 3ë§Œì› / ì—¬ì 2ë§Œì›\nê³„ì¢Œ: ..."
   # ë“±ë“±...

   message = renderer.render(template_key, variables)
   # {{name}}ë‹˜ â†’ ê¹€ì² ìˆ˜ë‹˜
   # {{building}}ë™ â†’ Aë™
   # {{totalParticipants}}ëª… â†’ 25ëª…
   ```
3. ë Œë”ë§ëœ ë©”ì‹œì§€ ë°œì†¡

### ëˆ„ë½ëœ ë³€ìˆ˜ ê°ì§€

```python
unreplaced = re.findall(r'\{\{(\w+)\}\}', message)
if unreplaced:
    logger.warning(f"Undefined variables: {unreplaced}")
```

- ëŒ€ì²´ë˜ì§€ ì•Šì€ ë³€ìˆ˜ê°€ ìˆìœ¼ë©´ ê²½ê³  ë¡œê·¸
- í•˜ì§€ë§Œ **ì—ëŸ¬ëŠ” ë°œìƒí•˜ì§€ ì•ŠìŒ** (ê°œë°œ ì¤‘ ìœ ì—°ì„±)

## ğŸ“Š ë³€ìˆ˜ ê°’ ì˜ˆì‹œ

ì‹¤ì œ ë°œì†¡ ì‹œ ê³„ì‚°ë˜ëŠ” ê°’ ì˜ˆì‹œ:

```python
{
    'name': 'ê¹€ì² ìˆ˜',
    'phone': '010-1234-5678',
    'building': 'A',
    'roomNum': '101',
    'roomNumber': 'A101',
    'roomInfo': 'ë”ë¸”ë£¸',
    'password': '60100',
    'priceInfo': 'ë‚¨ì 3ë§Œì› / ì—¬ì 2ë§Œì›\nê³„ì¢Œ: ì¹´ì¹´ì˜¤ë±…í¬ 3333-12-3456789 (í™ê¸¸ë™)',
    'partyTime': 'ì €ë… 8ì‹œ',
    'secondPartyTime': 'ë°¤ 10ì‹œ',
    'totalParticipants': '25',
    'femaleCount': '12',
    'maleCount': '13',
    'date': '2026-02-09',
    'time': '14:00',
    'location': 'ìŠ¤í…Œì´ë¸” Bë™ 1ì¸µ í¬ì°¨'
}
```

## ğŸ¨ ì‚¬ìš©ì ê²½í—˜

### Before (ìˆ˜ì • ì „)
- âŒ ì–´ë–¤ ë³€ìˆ˜ë¥¼ ì“¸ ìˆ˜ ìˆëŠ”ì§€ ë¶ˆëª…í™•
- âŒ ì§ì ‘ í…ìŠ¤íŠ¸ ì…ë ¥ (ì˜¤íƒ€ ê°€ëŠ¥)
- âŒ `{{priceInfo}}` ê°™ì€ ê²Œ ê·¸ëŒ€ë¡œ SMSì— í¬í•¨ë  ìˆ˜ ìˆìŒ

### After (ìˆ˜ì • í›„)
- âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜ ëª©ë¡ ëª…í™•íˆ í‘œì‹œ
- âœ… Selectë¡œ ì„ íƒ (ì˜¤íƒ€ ë°©ì§€)
- âœ… ì¹´í…Œê³ ë¦¬ë³„ ê·¸ë£¹í™” (ì˜ˆì•½/ê°ì‹¤/íŒŒí‹°)
- âœ… ê° ë³€ìˆ˜ì˜ ì„¤ëª…ê³¼ ì˜ˆì‹œ í™•ì¸ ê°€ëŠ¥
- âœ… ë°±ì—”ë“œì—ì„œ ìë™ìœ¼ë¡œ ëª¨ë“  ë³€ìˆ˜ ê³„ì‚°

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

```
=== ë³€ìˆ˜ ìë™ ê³„ì‚° í…ŒìŠ¤íŠ¸ ===

ì˜ˆì•½ì: ê¹€ì² ìˆ˜
ê°ì‹¤: A101
ë‚ ì§œ: 2026-02-08

ê³„ì‚°ëœ ë³€ìˆ˜ë“¤:
  building: A
  femaleCount: 0
  maleCount: 4
  name: ê¹€ì² ìˆ˜
  partyTime: ì €ë… 8ì‹œ
  password: 60100
  priceInfo: ë‚¨ì 3ë§Œì› / ì—¬ì 2ë§Œì›
  roomNum: 101
  totalParticipants: 4

í…œí”Œë¦¿ ë Œë”ë§ ê²°ê³¼:
ê¹€ì² ìˆ˜ë‹˜ ì•ˆë…•í•˜ì„¸ìš”!

ê°ì‹¤ ì´ìš© í›„ 1ì°¨ íŒŒí‹° ì°¸ì—¬ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.

ğŸ¨ ê°ì‹¤: Aë™ 101í˜¸
ğŸ” ë¹„ë°€ë²ˆí˜¸: 60100
â° íŒŒí‹° ì‹œì‘: ì €ë… 8ì‹œ
ğŸ’° íŒŒí‹° ì°¸ì—¬ë¹„: ë‚¨ì 3ë§Œì› / ì—¬ì 2ë§Œì›

âœ… ëª¨ë“  ë³€ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ ëŒ€ì²´ë˜ì—ˆìŠµë‹ˆë‹¤!
```

## ğŸ“ ì‚¬ìš© ë°©ë²•

### 1. í…œí”Œë¦¿ ìƒì„±

1. Templates í˜ì´ì§€ â†’ "ìƒˆ í…œí”Œë¦¿" í´ë¦­
2. í…œí”Œë¦¿ ë‚´ìš© ì‘ì„±:
   ```
   {{name}}ë‹˜ ì•ˆë…•í•˜ì„¸ìš”!

   ê°ì‹¤: {{building}}ë™ {{roomNum}}í˜¸
   ë¹„ë°€ë²ˆí˜¸: {{password}}

   íŒŒí‹° ì‹œê°„: {{partyTime}}
   ì´ ì¸ì›: {{totalParticipants}}ëª…
   ```
3. "ì‚¬ìš© ê°€ëŠ¥í•œ ë³€ìˆ˜" í•„ë“œì—ì„œ ì‚¬ìš©í•œ ë³€ìˆ˜ ì„ íƒ:
   - `name`
   - `building`
   - `roomNum`
   - `password`
   - `partyTime`
   - `totalParticipants`

### 2. ë³€ìˆ˜ ì¶”ê°€í•˜ê¸° (ê°œë°œì)

ìƒˆë¡œìš´ ë³€ìˆ˜ë¥¼ ì¶”ê°€í•˜ë ¤ë©´ `backend/app/templates/variables.py` ìˆ˜ì •:

```python
AVAILABLE_VARIABLES = {
    "newVariable": {
        "description": "ì„¤ëª…",
        "example": "ì˜ˆì‹œ",
        "category": "party"  # reservation, room, party, datetime, other
    }
}

def calculate_template_variables(...):
    variables['newVariable'] = 'ê³„ì‚°ëœ ê°’'
    return variables
```

## ğŸ“ ìˆ˜ì •ëœ íŒŒì¼

### ë°±ì—”ë“œ
- âœ… `backend/app/templates/variables.py` (ì‹ ê·œ)
- âœ… `backend/app/api/templates.py` (+15 lines)
- âœ… `backend/app/campaigns/tag_manager.py` (+6 lines)
- âœ… `backend/app/db/seed.py` (í…œí”Œë¦¿ ë³€ìˆ˜ëª… ìˆ˜ì •)

### í”„ë¡ íŠ¸ì—”ë“œ
- âœ… `frontend/src/services/api.ts` (+1 line)
- âœ… `frontend/src/pages/Templates.tsx` (+50 lines)

## ğŸš€ ë‹¤ìŒ ë‹¨ê³„

ì‹œìŠ¤í…œì´ ì™„ì „íˆ ì‘ë™í•©ë‹ˆë‹¤! ì´ì œ:

1. **í…œí”Œë¦¿ í˜ì´ì§€ í™•ì¸**: http://localhost:5173/templates
2. **ìƒˆ í…œí”Œë¦¿ ìƒì„±** ë˜ëŠ” **ê¸°ì¡´ í…œí”Œë¦¿ í¸ì§‘**
3. **ë³€ìˆ˜ ì„ íƒ UI í™•ì¸** - ë“œë¡­ë‹¤ìš´ì—ì„œ ë³€ìˆ˜ ì„ íƒ
4. **ìº í˜ì¸ ë°œì†¡ í…ŒìŠ¤íŠ¸** - ëª¨ë“  ë³€ìˆ˜ê°€ ìë™ìœ¼ë¡œ ì±„ì›Œì§

---

**êµ¬í˜„ ì™„ë£Œ!** ğŸ‰
